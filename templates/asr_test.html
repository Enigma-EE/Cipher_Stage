<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ASR 测试页</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; padding: 16px; }
    .row { margin-bottom: 12px; }
    label { display: inline-block; width: 140px; }
    input[type="text"], select { width: 300px; }
    #result { white-space: pre-wrap; background: #f7f7f7; padding: 12px; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>本地 ASR 测试（faster-whisper）</h2>
  <div class="row">
    <label>选择音频文件：</label>
    <input type="file" id="file" accept="audio/*,.wav,.mp3" />
  </div>
  <div class="row">
    <label>模型：</label>
    <select id="model">
      <option value="small.en" selected>small.en（低延迟，英语优先）</option>
      <option value="base.en">base.en（更快，精度略低）</option>
      <option value="distil-whisper/distil-large-v2">distil-large-v2（更高精度，仍较快）</option>
      <option value="distil-whisper/distil-large-v3">distil-large-v3（更高精度，仍较快）</option>
      <option value="openai/whisper-large-v3">whisper-large-v3（最高精度，延迟更高）</option>
    </select>
  </div>
  <div class="row">
    <label>语言：</label>
    <select id="language">
      <option value="en" selected>English</option>
      <option value="zh">Chinese</option>
      <option value="ja">Japanese</option>
    </select>
  </div>
  <div class="row">
    <label>GPU 使用：</label>
    <select id="use_gpu">
      <option value="auto" selected>auto</option>
      <option value="true">true</option>
      <option value="false">false</option>
    </select>
  </div>
  <div class="row">
    <button id="btn">开始识别</button>
  </div>

  <h3>识别结果</h3>
  <div id="result">尚未识别</div>

  <script>
    const btn = document.getElementById('btn');
    const resultEl = document.getElementById('result');
    btn.addEventListener('click', async () => {
      const fileEl = document.getElementById('file');
      const model = document.getElementById('model').value;
      const language = document.getElementById('language').value;
      const use_gpu = document.getElementById('use_gpu').value;
      if (!fileEl.files[0]) { alert('请先选择音频文件'); return; }
      const fd = new FormData();
      fd.append('file', fileEl.files[0]);
      fd.append('backend', 'faster-whisper');
      fd.append('whisper_model', model);
      fd.append('language', language);
      fd.append('use_gpu', use_gpu);
      try {
        resultEl.textContent = '上传中并识别，请稍候...';
        const resp = await fetch('/api/asr/local', { method: 'POST', body: fd });
        const json = await resp.json();
        resultEl.textContent = JSON.stringify(json, null, 2);
      } catch (e) {
        resultEl.textContent = '请求失败: ' + e;
      }
    });
  </script>
</body>
</html>